<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Around The World by Gabriel Georgescu</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/plugins.css">
    <link rel="stylesheet" type="text/css" href="css/settings.css">
    <link rel="stylesheet" type="text/css" href="css/layers.css">
    <link rel="stylesheet" type="text/css" href="css/navigation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/purple.css">
</head>
<body>
<div class="content-wrapper">
    <nav class="navbar wide transparent absolute inverse-text text-uppercase navbar-expand-lg">
        <div class="container-fluid flex-row justify-content-center">
            <div class="navbar-header">
                <div class="navbar-brand"><a href="/"><img src="#"
                                                           srcset="images/logo2-light.png 1x, images/logo2-light@2x.png 2x"
                                                           alt=""/></a></div>
                <div class="navbar-hamburger ml-auto d-lg-none d-xl-none">
                    <button class="hamburger animate" data-toggle="collapse" data-target=".navbar-collapse">
                        <span></span></button>
                </div>
            </div>
            <!-- /.navbar-header -->
            <div class="navbar-collapse collapse justify-content-between align-items-center">
                <ul class="navbar-nav plain mx-auto text-center">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#top">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#sneak_peek">Sneak Peek</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#roadmap">Roadmap</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#faq">FAQ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html#team">Team</a>
                    </li>
                </ul>
            </div>
            <div class="social-wrapper text-right">
                <ul class="social social-mute social-s mb-0">
                    <li>
                        <a href="https://opensea.io/collection/around-the-world-by-gabriel-georgescu" target="_blank">
                            <img src="https://storage.googleapis.com/opensea-static/Logomark/Logomark-Transparent%20White.png" height="22"  alt="opensea"/>
                        </a>
                    </li>
                    <li><a href="https://www.facebook.com/gabygeorgescuphotography/" target="_blank"><i
                            class="fab fa-facebook-f"></i></a></li>
                    <li><a href="https://www.instagram.com/georgescugabrielphotography/" target="_blank"><i
                            class="fab fa-instagram"></i></a></li>
                    <li><a href="https://twitter.com/ATWGG_NFT" target="_blank"><i
                            class="fab fa-twitter"></i></a></li>
                    <li><a href="https://discord.gg/62vJuHpvY7" target="_blank"><i class="fab fa-discord"></i></a></li>
                </ul>
            </div>
            <!--/.social-wrapper -->
        </div>
    </nav>
    <div class="wrapper image-wrapper bg-image inverse-text" data-image-src="images/roadmap.jpg" style="background-image: url('images/roadmap.jpg');">
        <div class="container inner pt-120 pb-120">
            <h2 class="section-title mb-40 text-center">Mint</h2>
            <div class="row">
                <div class="card text-white bg-dark mb-3 col-md-12 col-xs-12 col-lg-12 p-0">
                    <div class="card-header">
                        <h1 class="text-center" id="title_header"></h1>
                    </div>
                    <div class="card-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-6 col-xs-12 col-lg-6">
                                    <img src="https://ipfs.io/ipfs/QmQtSZCtU3B1Z7SY7J74fKs7jH9Vn7ATaWPo5LG4vvGZFz/unrevealed.jpg" alt="image" style="width: 100%" />
                                </div>
                                <div class="col-md-6 col-xs-12 col-lg-6">
                                    <h2 class="card-title text-center">Price: <span id="token_price"></span> ETH</h2>
                                    <h3 id="supply" class="text-center">Available: 0/6,999</h3>
                                    <h3 id="whitelist_max_supply" class="text-center hidden"></h3>
                                    <label for="quantity" class="text-center col-md-12 col-xs-12 col-lg-12" id="">
                                        Quantity: <span class="text-span-7"><span id="max_mint"></span> Mint Per <span id="max_type"></span></span>
                                    </label>
                                    <select id="quantity" name="quantity" data-name="quantity" required="">
                                    </select>
                                    <h5 class="text-center"><span id="price"></span></h5>
                                    <div class="alert alert-success hidden" id="success">
                                        <div>Thank you! Your submission has been received!</div>
                                    </div>
                                    <div class="alert alert-danger hidden" id="fail">
                                        <div>Oops! Something went wrong while submitting the form.</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-footer text-muted">
                        <button class="btn btn-aqua col-md-12 col-xs-12 col-lg-12" onclick="connect()" id="connect_wallet">Connect wallet</button>
                        <button class="btn btn-pastel-blue hidden col-md-12 col-xs-12 col-lg-12" onclick="mintToken()" id="mint_button">Mint token</button>
                        <div class="alert alert-danger hidden" id="minting_close">
                            <div>Minting is not open.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.wrapper -->
    <footer class="dark-wrapper inverse-text">
        <div class="container inner">
            <p class="text-center mb-0">&copy; 2022 Gabriel Georgescu. All rights reserved.</p>
        </div>
    </footer>
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.1.umd.min.js" type="text/javascript"></script>

    <script>
        let maxNFT = 4;
        let wlMaxSale = 2000;
        const contractAddress = "0x3Ee2Bb0eCE09bDb3a390b5f9C0746C2f41491a4D";
        let cost;
        let nftNumField = jQuery("#quantity");
        jQuery(document).ready(function (){
            jQuery("#supply").html("Sold: please connect");
            nftNumField.change(function (){
                jQuery("#price").html("Price: " + (cost * nftNumField.val()) + " ETH + gas");
            })
        });

        let wl_sale = false;
        let public_sale = false;
        let supply = 6999
        let nftNum = 1
        let is_whitelisted = false;

        const abi = [
            {
                "inputs":[

                ],
                "name":"MAX_TOKENS",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"WL_MAX_WALLET",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"WL_PRICE",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"WL_SALE_MAX_TOKENS",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[
                    {
                        "internalType":"address",
                        "name":"_user",
                        "type":"address"
                    }
                ],
                "name":"isWhitelisted",
                "outputs":[
                    {
                        "internalType":"bool",
                        "name":"",
                        "type":"bool"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"PUBLIC_PRICE",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"saleIsActive",
                "outputs":[
                    {
                        "internalType":"bool",
                        "name":"",
                        "type":"bool"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"wlSaleIsActive",
                "outputs":[
                    {
                        "internalType":"bool",
                        "name":"",
                        "type":"bool"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[

                ],
                "name":"totalSupply",
                "outputs":[
                    {
                        "internalType":"uint256",
                        "name":"",
                        "type":"uint256"
                    }
                ],
                "stateMutability":"view",
                "type":"function"
            },
            {
                "inputs":[
                    {
                        "internalType":"uint256",
                        "name":"amount",
                        "type":"uint256"
                    }
                ],
                "name":"mintTokenWlSale",
                "outputs":[

                ],
                "stateMutability":"payable",
                "type":"function"
            },
            {
                "inputs":[
                    {
                        "internalType":"uint256",
                        "name":"amount",
                        "type":"uint256"
                    }
                ],
                "name":"mintToken",
                "outputs":[

                ],
                "stateMutability":"payable",
                "type":"function"
            },
        ]
        let signer
        let provider

        async function connect() {
            if (!window.ethereum) {
                alert("No wallet installed. Please install a wallet on the browser - MetaMask is preferred!")
                return
            }

            provider = await new ethers.providers.Web3Provider(window.ethereum, "mainnet")
            await provider.send("eth_requestAccounts", [])

            signer = provider.getSigner()
            let is_whitelisted = false;

            getMaxTokens();
            isWhitelistSaleActive();
            isPublicSaleActive();
            getSupply()
            jQuery("#connect_wallet").hide();
        }

        async function getSupply() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.totalSupply().then((res) => {
                jQuery("#supply").html("Sold: " + res + " / " + supply.toString());
            })
        }

        async function getMaxTokens() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.MAX_TOKENS().then((res) => {
                supply = res;
            })
        }

        async function getPublicSalePrice() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.PUBLIC_PRICE().then((res) => {
                cost = convertWeiToEth(res.toString());
                jQuery("#token_price").html(cost);
            })
        }

        async function getWhitelistPrice() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.WL_PRICE().then((res) => {
                cost = convertWeiToEth(res.toString());
                jQuery("#token_price").html(cost);
            });
        }

        async function getWhitelistLimit() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.WL_SALE_MAX_TOKENS().then((res) => {
                wlMaxSale = res.toString();
            })
        }

        async function getWhitelistTotalSupply() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.WL_MAX_WALLET().then((res) => {
                maxNFT = res.toString();
            })
        }

        async function isInWhitelist() {
            let signer = provider.getSigner()
            let address = await signer.getAddress()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.isWhitelisted(address).then((res) => {
                is_whitelisted = res;
            })
        }

        async function isWhitelistSaleActive() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.wlSaleIsActive().then((res) => {
                if(res){
                    wl_sale = true;
                    getWhitelistPrice();
                    getWhitelistTotalSupply();
                    getWhitelistLimit();
                    jQuery("#title_header").html("Whitelist Mint");
                    jQuery("#max_mint").html(maxNFT);
                    jQuery("#max_type").html("Wallet");
                    jQuery("#token_price").html(cost);
                    jQuery("#whitelist_max_supply").html("Max whitelist: " + wlMaxSale).removeClass("hidden");
                    isInWhitelist().then((res) => {
                        if(is_whitelisted){
                            jQuery("#mint_button").removeClass("hidden");
                        }
                    });
                }
            })
        }

        async function isPublicSaleActive() {
            let signer = provider.getSigner()
            let contract = new ethers.Contract(contractAddress, abi, signer)
            contract.saleIsActive().then((res) => {
                if(res){
                    public_sale = true;
                    getPublicSalePrice();
                    maxNFT = 10;
                    jQuery("#title_header").html("Public Sale Mint");
                    jQuery("#max_mint").html(maxNFT);
                    jQuery("#max_type").html("Tx");
                    jQuery("#quantity").empty();
                    for (let i = 1; i <= maxNFT; i++) {
                        jQuery("#quantity").append('<option value="' + i + '">' + i + '</option>');
                    }
                    jQuery("#mint_button").removeClass("hidden");
                }
            });
        }

        async function mintToken() {
            nftNum = jQuery("#quantity").val();
            if(Math.floor(Number(nftNum)) === 0) {
                alert("Num of NFTs should be > 0")
            } else {
                if(Math.floor(Number(nftNum)) > maxNFT) {
                    alert("Num of NFTs should be <= " + maxNFT.toString())
                }
            }

            let contract = new ethers.Contract(contractAddress, abi, signer)
            let overrides = {value: ethers.utils.parseEther((nftNum * cost).toString())}

            console.log(wl_sale);
            console.log(public_sale);
            if(wl_sale) {
                contract.mintTokenWlSale(nftNum, overrides).then((res) => {
                        alert("Token being minted! After receiving confirmation from your wallet, you can see it at Opensea or on your wallet")
                    }
                ).catch(function (e) {
                    if (JSON.stringify(e).indexOf("underlying network") > -1)
                        alert("Sorry, seems your wallet is not connected to ethereum mainnet - are you connected instead to BSC?")
                    else if (JSON.stringify(e).indexOf("insufficient funds") > -1)
                        alert("Sorry, seems your wallet doesn't have enough funds to make this purchase!")
                    else if (JSON.stringify(e).indexOf("Max NFT") > -1)
                        alert("Sorry, purchase would exceed limit per wallet!")
                    else if (JSON.stringify(e).indexOf("would exceed max supply") > -1)
                        alert("Sorry, sold out!")
                    else if (!e.message.split("rror=")[1]) alert("Sorry, we could not complete your transaction. " + e.message.split("rror=")[0])
                    else alert("Sorry, we could not complete your transaction. " + JSON.parse(e.message.split("rror=")[1].split(", method")[0]).message.replace("execution reverted: ", ""))
                })
            }
            if(public_sale){
                contract.mintToken(nftNum, overrides).then((res) => {
                        alert("Token being minted! After receiving confirmation from your wallet, you can see it at Opensea or on your wallet")
                    }
                ).catch(function (e) {
                    if (JSON.stringify(e).indexOf("underlying network") > -1)
                        alert("Sorry, seems your wallet is not connected to ethereum mainnet - are you connected instead to BSC?")
                    else if (JSON.stringify(e).indexOf("insufficient funds") > -1)
                        alert("Sorry, seems your wallet doesn't have enough funds to make this purchase!")
                    else if (JSON.stringify(e).indexOf("Max NFT") > -1)
                        alert("Sorry, purchase would exceed limit per wallet!")
                    else if (JSON.stringify(e).indexOf("would exceed max supply") > -1)
                        alert("Sorry, sold out!")
                    else if (!e.message.split("rror=")[1]) alert("Sorry, we could not complete your transaction. " + e.message.split("rror=")[0])
                    else alert("Sorry, we could not complete your transaction. " + JSON.parse(e.message.split("rror=")[1].split(", method")[0]).message.replace("execution reverted: ", ""))
                })
            }
        }

        function convertWeiToEth(value) {
            return value/1000000000000000000;
        }
    </script>
</div>
</body>
</html>